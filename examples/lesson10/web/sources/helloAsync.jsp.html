<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <title>helloAsync.jsp</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="../res/styles.css" type="text/css">
    <style type="text/css">
      <!--
      .ST9 {color: #0000e6; background-color: #e3f2e1}
      .ST4 {font-weight: bold}
      .ST12 {color: #009900; background-color: #e3f2e1}
      .ST8 {color: #009900}
      .scriptlet-delimiter {background-color: #e3f2e1}
      .ST10 {background-color: #e3f2e1; font-weight: bold}
      .ST3 {color: #ce7b00; background-color: #e9eff8}
      .ST7 {color: #0000e6}
      .ST5 {color: #0000e6; font-weight: bold}
      .attribute-name {color: #009b00}
      .ST0 {background-color: #e9eff8; font-weight: bold}
      .ST11 {color: #ce7b00; background-color: #e3f2e1}
      .ST6 {color: #628fb5}
      .ST13 {color: #007c00; background-color: #e3f2e1; font-weight: bold}
      .ST1 {color: #0000e6; background-color: #e9eff8; font-weight: bold}
      .attribute-value {color: #ce7b00}
      .ST2 {color: #009b00; background-color: #e9eff8}
      -->
    </style>
  </head>
  <body>
    <script src="../res/jquery.js" type="text/javascript"></script>
    <script src="../res/jquery.tooltip.js" type="text/javascript"></script>
    <script src="../res/tooltip.js" type="text/javascript"></script>
    <p>
      <a href="../">Go back</a>
    </p>
    <table width="100%"><tr><td align="center">D:\labs\examples\lesson10\web\helloAsync.jsp</td></tr></table>
    <pre>
<span class="info" title="tt-overview"><span class="ST0">&lt;%@</span><span class="ST1"> taglib</span> <span class="ST2">prefix</span><span class="ST0">=</span><span class="ST3">&quot;c&quot;</span> <span class="ST2">uri</span><span class="ST0">=</span><span class="ST3">&quot;</span><span class="ST3">http://java.sun.com/jsp/jstl/core</span><span class="ST3">&quot;</span> <span class="ST0">%&gt;</span>
<span class="ST4">&lt;%@</span><span class="ST5">page</span> <span class="attribute-name">contentType</span><span class="ST4">=</span><span class="attribute-value">&quot;text/html&quot;</span> <span class="attribute-name">pageEncoding</span><span class="ST4">=</span><span class="attribute-value">&quot;UTF-8&quot;</span><span class="ST4">%&gt;</span>
<span class="ST6">&lt;!DOCTYPE</span> <span class="ST6">html</span><span class="ST6">&gt;</span>
<span class="ST7">&lt;</span><span class="ST7">html</span><span class="ST7">&gt;</span>
  <span class="ST7">&lt;</span><span class="ST7">head</span><span class="ST7">&gt;</span>
    <span class="ST7">&lt;</span><span class="ST7">meta</span> <span class="ST8">http-equiv</span><span class="ST8">=</span><span class="attribute-value">&quot;Content-Type&quot;</span> <span class="ST8">content</span><span class="ST8">=</span><span class="attribute-value">&quot;text/html; charset=UTF-8&quot;</span><span class="ST7">&gt;</span>
    <span class="ST7">&lt;</span><span class="ST7">title</span><span class="ST7">&gt;</span>Hello Async!<span class="ST7">&lt;/</span><span class="ST7">title</span><span class="ST7">&gt;</span>
  <span class="ST7">&lt;/</span><span class="ST7">head</span><span class="ST7">&gt;</span></span>
  <span class="ST7">&lt;</span><span class="ST7">body</span> <span class="ST8">onload</span><span class="ST8">=</span><span class="attribute-value">&quot;</span><span class="scriptlet-delimiter">startHello</span><span class="scriptlet-delimiter">(</span><span class="scriptlet-delimiter">)</span><span class="attribute-value">&quot;</span><span class="ST7">&gt;</span>
    <span class="ST7">&lt;</span><span class="ST7">script</span> <span class="ST8">type</span><span class="ST8">=</span><span class="attribute-value">&quot;text/javascript&quot;</span><span class="ST7">&gt;</span>
      <span class="info" title="tt-startHello"><span class="ST9">function</span> <span class="ST10">startHello</span><span class="scriptlet-delimiter">(</span><span class="scriptlet-delimiter">)</span><span class="scriptlet-delimiter">{</span>
        <span class="ST9">var</span> <span class="scriptlet-delimiter">xmlhttp</span> <span class="scriptlet-delimiter">=</span> <span class="scriptlet-delimiter">initRequest</span><span class="scriptlet-delimiter">(</span><span class="scriptlet-delimiter">)</span><span class="scriptlet-delimiter">;</span></span>
        <span class="info" title="tt-url"><span class="ST9">var</span> <span class="scriptlet-delimiter">url</span> <span class="scriptlet-delimiter">=</span> <span class="ST11">&quot;</span><span class="ST11">HelloAsyncServlet?var=</span><span class="ST11">&quot;</span><span class="scriptlet-delimiter">+</span><span class="ST9">new</span> <span class="scriptlet-delimiter">Date</span><span class="scriptlet-delimiter">(</span><span class="scriptlet-delimiter">)</span><span class="scriptlet-delimiter">.</span><span class="scriptlet-delimiter">getTime</span><span class="scriptlet-delimiter">(</span><span class="scriptlet-delimiter">)</span><span class="scriptlet-delimiter">;</span></span>
        <span class="info" title="tt-open"><span class="scriptlet-delimiter">xmlhttp</span><span class="scriptlet-delimiter">.</span><span class="scriptlet-delimiter">open</span><span class="scriptlet-delimiter">(</span><span class="ST11">&quot;</span><span class="ST11">GET</span><span class="ST11">&quot;</span><span class="scriptlet-delimiter">,</span> <span class="scriptlet-delimiter">url</span><span class="scriptlet-delimiter">,</span> <span class="ST9">true</span><span class="scriptlet-delimiter">)</span><span class="scriptlet-delimiter">;</span></span>
<span class="info" title="tt-readyState">        <span class="scriptlet-delimiter">xmlhttp</span><span class="scriptlet-delimiter">.</span><span class="scriptlet-delimiter">onreadystatechange</span><span class="scriptlet-delimiter">=</span><span class="ST9">function</span><span class="scriptlet-delimiter">(</span><span class="scriptlet-delimiter">)</span><span class="scriptlet-delimiter">{</span>
          <span class="ST9">if</span> <span class="scriptlet-delimiter">(</span><span class="scriptlet-delimiter">xmlhttp</span><span class="scriptlet-delimiter">.</span><span class="scriptlet-delimiter">readyState</span><span class="scriptlet-delimiter">==</span><span class="scriptlet-delimiter">4</span> <span class="scriptlet-delimiter">&amp;&amp;</span> <span class="scriptlet-delimiter">xmlhttp</span><span class="scriptlet-delimiter">.</span><span class="scriptlet-delimiter">status</span><span class="scriptlet-delimiter">==</span><span class="scriptlet-delimiter">200</span><span class="scriptlet-delimiter">)</span> <span class="scriptlet-delimiter">{</span></span>
            <span class="info" title="tt-htmlReplace"><span class="ST12">document</span><span class="scriptlet-delimiter">.</span><span class="scriptlet-delimiter">getElementById</span><span class="scriptlet-delimiter">(</span><span class="ST11">&quot;</span><span class="ST11">asyncText</span><span class="ST11">&quot;</span><span class="scriptlet-delimiter">)</span><span class="scriptlet-delimiter">.</span><span class="scriptlet-delimiter">innerHTML</span> <span class="scriptlet-delimiter">=</span> <span class="scriptlet-delimiter">xmlhttp</span><span class="scriptlet-delimiter">.</span><span class="scriptlet-delimiter">responseText</span><span class="scriptlet-delimiter">;</span></span>
          <span class="scriptlet-delimiter">}</span>
        <span class="scriptlet-delimiter">}</span>
        <span class="scriptlet-delimiter">xmlhttp</span><span class="scriptlet-delimiter">.</span><span class="scriptlet-delimiter">send</span><span class="scriptlet-delimiter">(</span><span class="scriptlet-delimiter">)</span><span class="scriptlet-delimiter">;</span>
      <span class="scriptlet-delimiter">}</span>
      
<span class="info" title="tt-initRequest">      <span class="ST9">function</span> <span class="ST10">initRequest</span><span class="scriptlet-delimiter">(</span><span class="scriptlet-delimiter">)</span> <span class="scriptlet-delimiter">{</span>
        <span class="ST9">if</span> <span class="scriptlet-delimiter">(</span><span class="ST12">window</span><span class="scriptlet-delimiter">.</span><span class="scriptlet-delimiter">XMLHttpRequest</span><span class="scriptlet-delimiter">)</span> <span class="scriptlet-delimiter">{</span>
          <span class="ST9">if</span> <span class="scriptlet-delimiter">(</span><span class="ST12">navigator</span><span class="scriptlet-delimiter">.</span><span class="scriptlet-delimiter">userAgent</span><span class="scriptlet-delimiter">.</span><span class="scriptlet-delimiter">indexOf</span><span class="scriptlet-delimiter">(</span><span class="ST11">&#39;</span><span class="ST11">MSIE</span><span class="ST11">&#39;</span><span class="scriptlet-delimiter">)</span> <span class="scriptlet-delimiter">!=</span> <span class="scriptlet-delimiter">-</span><span class="scriptlet-delimiter">1</span><span class="scriptlet-delimiter">)</span> <span class="scriptlet-delimiter">{</span>
            <span class="ST12">isIE</span> <span class="scriptlet-delimiter">=</span> <span class="ST9">true</span><span class="scriptlet-delimiter">;</span>
          <span class="scriptlet-delimiter">}</span>
          <span class="ST9">return</span> <span class="ST9">new</span> <span class="scriptlet-delimiter">XMLHttpRequest</span><span class="scriptlet-delimiter">(</span><span class="scriptlet-delimiter">)</span><span class="scriptlet-delimiter">;</span>
        <span class="scriptlet-delimiter">}</span> <span class="ST9">else</span> <span class="ST9">if</span> <span class="scriptlet-delimiter">(</span><span class="ST12">window</span><span class="scriptlet-delimiter">.</span><span class="scriptlet-delimiter">ActiveXObject</span><span class="scriptlet-delimiter">)</span> <span class="scriptlet-delimiter">{</span>
          <span class="ST12">isIE</span> <span class="scriptlet-delimiter">=</span> <span class="ST9">true</span><span class="scriptlet-delimiter">;</span>
          <span class="ST9">return</span> <span class="ST9">new</span> <span class="scriptlet-delimiter">ActiveXObject</span><span class="scriptlet-delimiter">(</span><span class="ST11">&quot;</span><span class="ST11">Microsoft.XMLHTTP</span><span class="ST11">&quot;</span><span class="scriptlet-delimiter">)</span><span class="scriptlet-delimiter">;</span>
        <span class="scriptlet-delimiter">}</span>
      <span class="scriptlet-delimiter">}</span></span>
    <span class="ST7">&lt;/</span><span class="ST7">script</span><span class="ST7">&gt;</span>
    <span class="ST7">&lt;</span><span class="ST7">h1</span><span class="ST7">&gt;</span>Hello <span class="info" title="tt-spanElement"><span class="ST7">&lt;</span><span class="ST7">span</span> <span class="ST8">id</span><span class="ST8">=</span><span class="attribute-value">&quot;</span><span class="ST13">asyncText</span><span class="attribute-value">&quot;</span><span class="ST7">&gt;</span><span class="ST7">&lt;/</span><span class="ST7">span</span><span class="ST7">&gt;</span></span>!<span class="ST7">&lt;/</span><span class="ST7">h1</span><span class="ST7">&gt;</span>
    <span class="ST4">&lt;</span><span class="ST5">c:url</span> <span class="attribute-name">value</span><span class="ST4">=</span><span class="attribute-value">&quot;/index.jsp&quot;</span> <span class="attribute-name">var</span><span class="ST4">=</span><span class="attribute-value">&quot;homeUrl&quot;</span> <span class="ST4">/&gt;</span>
    <span class="ST7">&lt;</span><span class="ST7">a</span> <span class="ST8">href</span><span class="ST8">=</span><span class="attribute-value">&quot;</span><span class="scriptlet-delimiter">${</span><span class="scriptlet-delimiter">homeUrl</span><span class="scriptlet-delimiter">}</span><span class="attribute-value">&quot;</span><span class="ST7">&gt;</span>Go Home<span class="ST7">&lt;/</span><span class="ST7">a</span><span class="ST7">&gt;</span>
  <span class="ST7">&lt;/</span><span class="ST7">body</span><span class="ST7">&gt;</span>
<span class="ST7">&lt;/</span><span class="ST7">html</span><span class="ST7">&gt;</span>

    </pre>
    <div id="tt-spanElement">
      This span element has an id that allows the JavaScript code to find it and to replace the
      contents of this tag.
    </div>
    <div id="tt-htmlReplace">
      This line of JavaScript code replaces the contents of the element that contains the id asyncText with
      the result from the asynchronous response.
    </div>
    <div id="tt-readyState">
      The XmlHttp object notifies changes in the response (when complete, error or progress)
      using callbacks. In this case, you must add a callback to the OnReadyStateChange event in the object.
      The function provided is then executed when the request changes state. See the later if statement that you verify for an status 200 (OK) and a ReadyState 4 (Complete).
    </div>
    <div id="tt-open">
      The Open method in the XmlHttp object prepares the request with a given URL and a HTTP method.<br>
      Note that the later send method actually makes the request.<br>
      Form parameters are sent in the Send method.
    </div>
    <div id="tt-url">
      The URL for the Asynchronous request. Note the <code>var= + new Date().getTime()</code> serves
      as a way to prevent browser caching.
    </div>
    <div id="tt-startHello">
      The startHello function makes the asynchronous call.<br>
      It is called in the body onload tag.
    </div>
    <div id="tt-initRequest">
      Create XmlHttp objects that allows you to make requests using JavaScript.<br>
      Although most browsers include the XMLHttpRequest, Internet Explorer 6 and some older browsers must create a special type of object.<br>
      This code is required for compatibility with such browsers.
    </div>
    <div id="tt-overview">
      To take full advantage of asynchronous servlets, it is recommended to make asynchronous requests
      using JavaScript code or inner frames in the page.
      This example shows how to call a servlet from a JavaScript code and print the response
      from that servlet in the page.<br>
      This example uses basic JavaScript code. In your projects, you may opt for a JavaScript
      library that allows you to handle more functionality while making asynchronous requests.
    </div>
    <p>
      <a href="../">Go back</a>
    </p>
  </body>
</html>
