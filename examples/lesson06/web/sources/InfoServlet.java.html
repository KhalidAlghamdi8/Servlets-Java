<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <title>InfoServlet.java</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="../res/code.css" type="text/css">
    <style type="text/css">
      <!--
      .ST2 {font-style: italic}
      .ST0 {font-weight: bold}
      .ST3 {color: #ce7b00; font-weight: bold}
      .character {color: #ce7b00}
      .ST1 {color: #009900; font-style: italic}
      .keyword-directive {color: #0000e6}
      -->
    </style>
  </head>
  <body>
    <script src="../res/jquery.js" type="text/javascript"></script>
    <script src="../res/jquery.tooltip.js" type="text/javascript"></script>
    <script src="../res/tooltip.js" type="text/javascript"></script>
    <p>
      <a href="../">Go back</a>
    </p>
    <table width="100%"><tr><td align="center">D:\labs\examples\lesson06\src\java\com\examples\lesson06\servlets\InfoServlet.java</td></tr></table>
    <pre>
<span class="keyword-directive">package</span> com.examples.lesson06.servlets;

<span class="keyword-directive">import</span> java.io.IOException;
<span class="keyword-directive">import</span> java.io.PrintWriter;
<span class="keyword-directive">import</span> java.text.SimpleDateFormat;
<span class="keyword-directive">import</span> java.util.Date;
<span class="keyword-directive">import</span> javax.servlet.ServletException;
<span class="keyword-directive">import</span> javax.servlet.annotation.WebServlet;
<span class="keyword-directive">import</span> javax.servlet.http.HttpServlet;
<span class="keyword-directive">import</span> javax.servlet.http.HttpServletRequest;
<span class="keyword-directive">import</span> javax.servlet.http.HttpServletResponse;

@WebServlet(name = <span class="character">&quot;</span><span class="character">InfoServlet</span><span class="character">&quot;</span>, urlPatterns = {<span class="character">&quot;</span><span class="character">/info</span><span class="character">&quot;</span>})
<span class="keyword-directive">public</span> <span class="keyword-directive">class</span> <span class="ST0">InfoServlet</span> <span class="keyword-directive">extends</span> HttpServlet {

  <span class="keyword-directive">private</span> <span class="keyword-directive">static</span> <span class="keyword-directive">final</span> String <span class="ST1">SERVER_NAME</span> = <span class="character">&quot;</span><span class="character">TEST SERVER</span><span class="character">&quot;</span>;

  @Override
  <span class="keyword-directive">protected</span> <span class="keyword-directive">void</span> <span class="ST0">doGet</span>(HttpServletRequest request, HttpServletResponse response)
          <span class="keyword-directive">throws</span> ServletException, IOException {

<span class="info" title="tt-business">    String serverName = <span class="ST1">SERVER_NAME</span>;
    String serverMemory = formatBytes(Runtime.<span class="ST2">getRuntime</span>().maxMemory());
    String serverFreeMemory = formatBytes(Runtime.<span class="ST2">getRuntime</span>().freeMemory());
    String serverCores = Integer.<span class="ST2">toString</span>(Runtime.<span class="ST2">getRuntime</span>().availableProcessors());
    String serverTime = <span class="keyword-directive">new</span> SimpleDateFormat().format(<span class="keyword-directive">new</span> Date());</span>

<span class="info" title="tt-html">    response.setContentType(<span class="character">&quot;</span><span class="character">text/html;charset=UTF-8</span><span class="character">&quot;</span>);
    PrintWriter out = response.getWriter();
    out.println(<span class="character">&quot;</span><span class="character">&lt;html&gt;</span><span class="character">&quot;</span>);
    out.println(<span class="character">&quot;</span><span class="character">&lt;head&gt;</span><span class="character">&quot;</span>);
    out.println(<span class="character">&quot;</span><span class="character">&lt;title&gt;Servlet InfoServlet&lt;/title&gt;</span><span class="character">&quot;</span>);
    out.println(<span class="character">&quot;</span><span class="character">&lt;link rel=</span><span class="ST3">\&quot;</span><span class="character">stylesheet</span><span class="ST3">\&quot;</span><span class="character"> href=</span><span class="ST3">\&quot;</span><span class="character">res/styles.css</span><span class="ST3">\&quot;</span><span class="character"> type=</span><span class="ST3">\&quot;</span><span class="character">text/css</span><span class="ST3">\&quot;</span><span class="character">/&gt;</span><span class="character">&quot;</span>);
    out.println(<span class="character">&quot;</span><span class="character">&lt;/head&gt;</span><span class="character">&quot;</span>);
    out.println(<span class="character">&quot;</span><span class="character">&lt;body&gt;</span><span class="character">&quot;</span>);
    out.println(<span class="character">&quot;</span><span class="character">&lt;h1&gt;System information&lt;/h1&gt;</span><span class="character">&quot;</span>);
    out.println(<span class="character">&quot;</span><span class="character">&lt;ul&gt;</span><span class="character">&quot;</span>);
    out.println(<span class="character">&quot;</span><span class="character">&lt;li&gt;Server Name: </span><span class="character">&quot;</span> + serverName + <span class="character">&quot;</span><span class="character">&lt;/li&gt;</span><span class="character">&quot;</span>);
    out.println(<span class="character">&quot;</span><span class="character">&lt;li&gt;Server Memory: </span><span class="character">&quot;</span> + serverMemory + <span class="character">&quot;</span><span class="character">&lt;/li&gt;</span><span class="character">&quot;</span>);
    out.println(<span class="character">&quot;</span><span class="character">&lt;li&gt;Server FreeMemory: </span><span class="character">&quot;</span> + serverFreeMemory + <span class="character">&quot;</span><span class="character">&lt;/li&gt;</span><span class="character">&quot;</span>);
    out.println(<span class="character">&quot;</span><span class="character">&lt;li&gt;Server Cores: </span><span class="character">&quot;</span> + serverCores + <span class="character">&quot;</span><span class="character">&lt;/li&gt;</span><span class="character">&quot;</span>);
    out.println(<span class="character">&quot;</span><span class="character">&lt;li&gt;Server Time: </span><span class="character">&quot;</span> + serverTime + <span class="character">&quot;</span><span class="character">&lt;/li&gt;</span><span class="character">&quot;</span>);
    out.println(<span class="character">&quot;</span><span class="character">&lt;/ul&gt;</span><span class="character">&quot;</span>);
    out.println(<span class="character">&quot;</span><span class="character">&lt;a href=</span><span class="ST3">\&quot;</span><span class="character">index.html</span><span class="ST3">\&quot;</span><span class="character">&gt;Go Home&lt;/a&gt;</span><span class="character">&quot;</span>);
    out.println(<span class="character">&quot;</span><span class="character">&lt;/body&gt;</span><span class="character">&quot;</span>);
    out.println(<span class="character">&quot;</span><span class="character">&lt;/html&gt;</span><span class="character">&quot;</span>);</span>
  }

<span class="info" title="tt-business">  <span class="keyword-directive">private</span> String <span class="ST0">formatBytes</span>(<span class="keyword-directive">long</span> bytes) {
    <span class="keyword-directive">if</span> (bytes &lt; 1024) {
      <span class="keyword-directive">return</span> bytes + <span class="character">&quot;</span><span class="character">B</span><span class="character">&quot;</span>;
    }
    <span class="keyword-directive">if</span> (bytes &lt; 1024 * 1024) {
      <span class="keyword-directive">return</span> (bytes / 1024) + <span class="character">&quot;</span><span class="character">KB</span><span class="character">&quot;</span>;
    }
    <span class="keyword-directive">return</span> (bytes / (1024 * 1024)) + <span class="character">&quot;</span><span class="character">MB</span><span class="character">&quot;</span>;
  }</span>
}

    </pre>
    <div id="tt-business">
      This is the business logic that must be separated from the servlet.<br>
      The code outlined in this example is simple, but usually servlets should only
      do some basic validation and formating of data. All business logic should be separated in
      other classes.<br>
      Whenever you need a database connection or you need to do some complex operations, do so in
      other classes and let the servlet call methods on those classes.
    </div>
    <div id="tt-html">
      This is the display logic that must be separated from the servlet.<br>
      So far you have handled HTML output in servlets. However, you might have noticed that
      handling output this way is difficult and confusing. The HTML code inside the servlet
      is hard to read and there is no way to tell that the formatting is correct.
    </div>
    <p>
      <a href="../">Go back</a>
    </p>
  </body>
</html>
